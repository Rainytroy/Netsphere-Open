# 变量标识符解析问题修复报告

## 问题描述

当编辑器内容中同时包含两个相似的变量标识符（尤其是一个是另一个的前缀）时，会出现解析错误。例如，当文本中同时存在以下两个变量标识符时：
- `@gv_4016eae6-d884-4fdf-8934-d0823da680c2_actlv` 
- `@gv_4016eae6-d884-4fdf-8934-d0823da680c2_act`

系统会错误地将前者识别为后者，导致剩余的"lv"文本残留在解析结果中。这导致变量预览和解析结果异常。

## 问题复现

输入包含以下内容的文本：
```
@云透.actlv#4016 @云透.act#4016
```

解析后变量显示出现异常，实际返回内容为：
```
测试，为什么有时候成功好奇心是驱使我前进的动力，我关注一切美好的、有趣的事物，并且想要创造新东西，不在乎世俗的意义，只想要做成一些事情——是被心血和巧思构成的、完美主义的成果。lv
```

## 问题原因

在 `formatters.ts` 文件中，用于识别系统标识符的正则表达式不够严格，导致在文本替换过程中可能发生部分匹配：

```typescript
// 原有正则表达式
const regex = /@gv_[a-zA-Z0-9-]+_[a-zA-Z0-9_]+/g;
```

这个正则表达式可能会将 `@gv_UUID_actlv` 部分匹配为 `@gv_UUID_act`，导致 `lv` 这部分文本残留。

## 修复方案

1. 增强正则表达式，使用词边界 `\b` 确保只匹配完整的标识符：

```typescript
// 修复后的正则表达式
const regex = /@gv_[a-zA-Z0-9-]+_[a-zA-Z0-9_]+\b/g;
```

2. 改进标识符解析逻辑，使用更严格的匹配模式：

```typescript
// 原有匹配方式
const idFieldMatch = match.match(/@gv_([a-zA-Z0-9-]+)_([a-zA-Z0-9_]+)/);

// 修复后的匹配方式
const idFieldMatch = match.match(/@gv_([a-zA-Z0-9-]+)_([a-zA-Z0-9_]+)$/);
```

## 测试验证

通过测试验证，同时使用 `@云透.actlv#4016` 和 `@云透.act#4016` 两个变量后，解析结果不再出现残留文本，各个变量正确解析为对应的值。

## 影响范围

这个修复主要影响变量编辑器的解析功能，包括以下场景：
- 变量预览
- 内容解析
- 富文本转换

## 修复时间

修复日期：2025年3月30日
